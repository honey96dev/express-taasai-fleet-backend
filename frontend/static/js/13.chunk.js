(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{471:function(e,a,t){"use strict";var l=t(476);a.a={isEmail:e=>{return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},isUsername:e=>{return/^[0-9a-zA-Z_][0-9a-zA-Z_.-]+$/.test(String(e).toLowerCase())},isPhoneNumber:e=>{try{return Object(l.b)(e)}catch(a){return!1}},isURL:e=>e.startsWith("http://")||e.startsWith("https://")}},475:function(e,a,t){"use strict";var l=t(26),n=t(28),i=t(43);a.a={list:e=>new Promise((a,t)=>{Object(l.a)(n.d,i.a.drivers.list,e).then(e=>{a(e)},e=>{t(e)})}),get:e=>new Promise((a,t)=>{Object(l.a)(n.d,i.a.drivers.get,e).then(e=>{a(e)},e=>{t(e)})}),history:e=>new Promise((a,t)=>{Object(l.a)(n.d,i.a.drivers.history,e).then(e=>{a(e)},e=>{t(e)})}),add:e=>new Promise((a,t)=>{Object(l.a)(n.d,i.a.drivers.add,e).then(e=>{a(e)},e=>{t(e)})}),delete:e=>new Promise((a,t)=>{Object(l.a)(n.d,i.a.drivers.delete,e).then(e=>{a(e)},e=>{t(e)})}),activate:e=>new Promise((a,t)=>{Object(l.a)(n.d,i.a.drivers.activate,e).then(e=>{a(e)},e=>{t(e)})})}},563:function(e,a,t){},570:function(e,a,t){"use strict";t.r(a);var l=t(71),n=t(1),i=t.n(n),r=t(14),c=t(561),m=t(48),E=t(33),d=t(27),s=t(461),o=t(34),u=t(456),_=t(476),I=t(467),v=t(466),h=t(453),O=t(22),b=t(12),R=t(133),D=t(471);function S(){window.history.back()}var g=t(123),N=t(126),L=t(475),p=t(26),C=t(28),M=t(43),V=e=>new Promise((a,t)=>{Object(p.a)(C.d,M.a.core.getVehicleTypes,e).then(e=>{a(e)},e=>{t(e)})});t(562),t(563),a.default=(()=>{const e=Object(m.h)().params,a=Object(d.b)().t,t=Object(m.g)(),p=Object(o.c)(e=>e).auth.user,C=Object(n.useState)(!1),A=Object(l.a)(C,2),f=A[0],j=A[1],F=Object(n.useState)({}),T=Object(l.a)(F,2),U=T[0],B=T[1],x=Object(n.useState)(),w=Object(l.a)(x,2),P=w[0],y=w[1],H=Object(n.useState)({}),Z=Object(l.a)(H,2),z=Z[0],Q=Z[1],k=Object(n.useState)([]),q=Object(l.a)(k,2),X=q[0],G=q[1],W=Object(n.useState)(),J=Object(l.a)(W,2),K=J[0],Y=J[1],$=Object(n.useState)(),ee=Object(l.a)($,2),ae=ee[0],te=ee[1],le=Object(n.useRef)(null),ne=Object(n.useRef)(null),ie=["jpg","jpeg","png"],re=a("NAVBAR.DRIVERS.".concat(z.id?"EDIT":"ADD"));let ce="".concat(O.a.drivers.list,"/").concat(z.page||1);const me="".concat(O.a.drivers.add,"/").concat(s.Base64.encode(JSON.stringify({page:z.page})));let Ee,de={operator_id:p.operator_id,operator:p.operator_name,name:b.j.IS_DEV?"Test":"",mobile_number:b.j.IS_DEV?"+66642112451":"",license_number:b.j.IS_DEV?"TH33817":"",vehicle_name:b.j.IS_DEV?"Wagon":"",vehicle_type_id:b.j.IS_DEV?"1":"",vehicle_brand:b.j.IS_DEV?"Benz":"",vehicle_model:b.j.IS_DEV?"400":"",vehicle_color:b.j.IS_DEV?"Black":"",vehicle_number:b.j.IS_DEV?"ZA 113":"",vehicle_image:"",driver_image:""};const se=v.b().shape({operator_id:v.a().min(1,a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.OPERATOR")})),name:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.NAME")})),mobile_number:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.MOBILE")})).test("mobile_number.valid",a("COMMON.VALIDATION.INVALID",{field:a("DRIVERS.FIELDS.MOBILE")}),D.a.isPhoneNumber),license_number:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.LICENSE_NUMBER")})),vehicle_name:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_NAME")})),vehicle_type_id:v.a().min(1,a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_TYPE")})),vehicle_brand:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_BRAND")})),vehicle_model:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_MODEL")})),vehicle_color:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_COLOR")})),vehicle_number:v.d().required(a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_NUMBER")})),driver_image:v.d().test("vehicle_image.required",a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_IMAGE")}),function(e){return console.log(e,!!e&&!!e.length),!!e&&!!e.length||!!K}),vehicle_image:v.d().test("vehicle_image.required",a("COMMON.VALIDATION.REQUIRED",{field:a("DRIVERS.FIELDS.VEHICLE_IMAGE")}),function(e){return!!e&&!!e.length||!!ae})});Object(n.useEffect)(e=>{V().then(e=>{e.result===b.k.SUCCESS?G(e.data):G([])}).catch(e=>{G([])})},[]),Object(n.useMemo)(a=>{if(e)try{const t=s.Base64.decode(e),l=JSON.parse(t);Q(l)}catch(a){}},[e,a]),Object(n.useMemo)(e=>{z.id&&(j(!0),L.a.get({id:z.id,userId:p.id}).then(e=>{if(e.result===b.k.SUCCESS){const a=e.data;a.mobile_number="+".concat(a.dial_code).concat(a.mobile_number);const t=a.vehicle_image.split("/");t.length&&(t.splice(0,1),a.vehicle_image="".concat(M.a.assetsBaseUrl).concat(t.join("/")));const l=a.driver_image.split("/");l.length&&(l.splice(0,1),a.driver_image="".concat(M.a.assetsBaseUrl).concat(l.join("/"))),Ee.setValues(a),y(a.id)}j(!1)}).catch(e=>{j(!1)}))},[z.id]);const oe=Ee=Object(I.b)({initialValues:de,validationSchema:se,onSubmit:(e,{setSubmitting:t})=>{const l=Object(_.c)(e.mobile_number),n=new FormData;P&&n.append("id",P),n.append("fleet_id",p.id),n.append("operator_id",e.operator_id),n.append("name",e.name),n.append("dial_code",l.countryCallingCode),n.append("mobile_number",l.nationalNumber),n.append("license_number",e.license_number),n.append("vehicle_name",e.vehicle_name),n.append("vehicle_type_id",e.vehicle_type_id),n.append("vehicle_brand",e.vehicle_brand),n.append("vehicle_model",e.vehicle_model),n.append("vehicle_color",e.vehicle_color),n.append("vehicle_number",e.vehicle_number),K&&n.append("vehicleImage",K),ae&&n.append("driverImage",ae),t(!0),L.a.add(n).then(e=>{e.result===b.k.SUCCESS?(g.b.success(e.message),!P&&y(e.data.id)):g.b.error(e.message),t(!1)}).catch(e=>{g.b.error(a("COMMON.ERROR.UNKNOWN_SERVER_ERROR")),t(!1)})}}),ue=oe.values,_e=oe.touched,Ie=oe.errors,ve=oe.setValues,he=oe.setTouched,Oe=oe.setErrors,be=(oe.setFieldValue,oe.handleChange),Re=oe.handleBlur,De=oe.isSubmitting;return i.a.createElement(n.Fragment,null,i.a.createElement(u.Helmet,null,i.a.createElement("title",null,re," - ",a("SITE_NAME"))),i.a.createElement(r.e,null,i.a.createElement(r.f,null,a("NAVBAR.DRIVERS.ROOT")),i.a.createElement(r.f,null,i.a.createElement(E.b,{to:ce},a("NAVBAR.DRIVERS.LIST"))),i.a.createElement(r.f,{active:!0},re)),i.a.createElement(r.E,null,U.show&&i.a.createElement(r.j,{md:"12"},i.a.createElement(h.a,{in:U.show,classNames:"fade-transition",timeout:b.e.TRANSITION_TIME,unmountOnExit:!0,appear:!0},i.a.createElement(r.b,{color:U.color,dismiss:!0,onClosed:()=>B({})},U.message))),i.a.createElement(r.j,{md:"12"},i.a.createElement(r.h,null,i.a.createElement(r.i,null,!!f&&i.a.createElement(N.a,null),!f&&i.a.createElement(n.Fragment,null,i.a.createElement("form",{className:"mx-md-4 mx-sm-1 text-left",onSubmit:Ee.handleSubmit},i.a.createElement(r.E,null,i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"operator",name:"operator",label:a("DRIVERS.FIELDS.OPERATOR"),outline:!0,readOnly:!0,containerClass:"mb-0",value:ue.operator,onChange:be,onBlur:Re},!!_e.operator&&!!Ie.operator&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.operator))),i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"name",name:"name",label:a("DRIVERS.FIELDS.NAME"),outline:!0,containerClass:"mb-0",value:ue.name,onChange:be,onBlur:Re},!!_e.name&&!!Ie.name&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.name)))),i.a.createElement(r.E,null,i.a.createElement(r.j,{md:"6"},i.a.createElement("input",{hidden:!0,id:"mobile_number",name:"mobile_number",onChange:be,onBlur:Re}),i.a.createElement(_.a,{className:"md-form md-outline mt-3 mb-0",placeholder:a("DRIVERS.FIELDS.MOBILE"),flagUrl:"".concat(M.a.assetsBaseUrl).concat(M.a.assets.flags,"/{XX}.png"),value:ue.mobile_number,onChange:e=>R.a.triggerChangeEvent("mobile_number",e)}),!!_e.mobile_number&&!!Ie.mobile_number&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.mobile_number)),i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"license_number",name:"license_number",label:a("DRIVERS.FIELDS.LICENSE_NUMBER"),outline:!0,containerClass:"mt-3 mb-0",value:ue.license_number,onChange:be,onBlur:Re},!!_e.license_number&&!!Ie.license_number&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.license_number)))),i.a.createElement(r.E,null,i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"vehicle_name",name:"vehicle_name",label:a("DRIVERS.FIELDS.VEHICLE_NAME"),outline:!0,containerClass:"mt-3 mb-0",value:ue.vehicle_name,onChange:be,onBlur:Re},!!_e.vehicle_name&&!!Ie.vehicle_name&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_name))),i.a.createElement(r.j,{md:"6"},i.a.createElement("input",{hidden:!0,id:"vehicle_type_id",name:"vehicle_type_id",onChange:be,onBlur:Re}),i.a.createElement(r.F,{label:a("DRIVERS.FIELDS.VEHICLE_TYPE"),outline:!0,className:"mt-3 mb-0",selected:ue.vehicle_type_id,getValue:e=>{R.a.triggerChangeEvent("vehicle_type_id",e[0])}},i.a.createElement(r.G,null),X.length>0&&i.a.createElement(r.I,null,X.map((e,a)=>i.a.createElement(r.H,{key:a,value:e.id,checked:e.id==ue.vehicle_type_id},e.name)))),!!_e.vehicle_type_id&&!!Ie.vehicle_type_id&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_type_id))),i.a.createElement(r.E,null,i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"vehicle_brand",name:"vehicle_brand",label:a("DRIVERS.FIELDS.VEHICLE_BRAND"),outline:!0,containerClass:"mt-3 mb-0",value:ue.vehicle_brand,onChange:be,onBlur:Re},!!_e.vehicle_brand&&!!Ie.vehicle_brand&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_brand))),i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"vehicle_model",name:"vehicle_model",label:a("DRIVERS.FIELDS.VEHICLE_MODEL"),outline:!0,containerClass:"mt-3 mb-0",value:ue.vehicle_model,onChange:be,onBlur:Re},!!_e.vehicle_model&&!!Ie.vehicle_model&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_model)))),i.a.createElement(r.E,null,i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"vehicle_color",name:"vehicle_color",label:a("DRIVERS.FIELDS.VEHICLE_COLOR"),outline:!0,containerClass:"mt-3 mb-0",value:ue.vehicle_color,onChange:be,onBlur:Re},!!_e.vehicle_color&&!!Ie.vehicle_color&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_color))),i.a.createElement(r.j,{md:"6"},i.a.createElement(r.o,{id:"vehicle_number",name:"vehicle_number",label:a("DRIVERS.FIELDS.VEHICLE_NUMBER"),outline:!0,containerClass:"mt-3 mb-0",value:ue.vehicle_number,onChange:be,onBlur:Re},!!_e.vehicle_number&&!!Ie.vehicle_number&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_number)))),i.a.createElement(r.E,null,i.a.createElement(r.j,{md:"6",className:"text-left mt-4"},i.a.createElement("div",{className:"grey-text"},a("DRIVERS.FIELDS.VEHICLE_IMAGE")),i.a.createElement("div",{id:"file",className:"mx-auto"},!f&&i.a.createElement(c.a,{ref:le,defaultFileSrc:ue.vehicle_image,getValue:Y,showRemove:!1,maxFileSize:b.g.MAXSIZE1,maxFileSizePreview:b.g.MAXSIZE1,containerHeight:b.c.SIZE.HEIGHT+50,allowedFileExtensions:ie,messageDefault:a("COMMON.FILE_UPLOAD.DEFAULT"),messageReplace:a("COMMON.FILE_UPLOAD.REPLACE"),messageRemove:a("COMMON.FILE_UPLOAD.REMOVE"),messageError:a("COMMON.FILE_UPLOAD.ERROR"),errorFileSize:a("COMMON.FILE_UPLOAD.ERROR_FILESIZE",{max:b.g.MAXSIZE1})}),!!_e.vehicle_image&&!!Ie.vehicle_image&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.vehicle_image))),i.a.createElement(r.j,{md:"6",className:"text-left mt-4"},i.a.createElement("div",{className:"grey-text"},a("DRIVERS.FIELDS.DRIVER_IMAGE")),i.a.createElement("div",{id:"file",className:"mx-auto"},!f&&i.a.createElement(c.a,{ref:ne,defaultFileSrc:ue.driver_image,getValue:te,showRemove:!1,maxFileSize:b.g.MAXSIZE1,maxFileSizePreview:b.g.MAXSIZE1,containerHeight:b.c.SIZE.HEIGHT+50,allowedFileExtensions:ie,messageDefault:a("COMMON.FILE_UPLOAD.DEFAULT"),messageReplace:a("COMMON.FILE_UPLOAD.REPLACE"),messageRemove:a("COMMON.FILE_UPLOAD.REMOVE"),messageError:a("COMMON.FILE_UPLOAD.ERROR"),errorFileSize:a("COMMON.FILE_UPLOAD.ERROR_FILESIZE",{max:b.g.MAXSIZE1})}),!!_e.driver_image&&!!Ie.driver_image&&i.a.createElement("div",{className:"text-left invalid-field"},Ie.driver_image)))),i.a.createElement("div",{className:"mt-4 mb-3"},i.a.createElement(r.g,{type:"submit",color:"primary",size:"sm",rounded:!0,disabled:!!f||!!De},a("COMMON.BUTTON.".concat(P?"EDIT":"ADD"))),i.a.createElement(r.g,{type:"button",color:"indigo",size:"sm",rounded:!0,onClick:e=>(({setValues:e,setTouched:a,setErrors:l})=>{e(de),Y(null),le.current&&le.current.resetPreview(),te(null),ne.current&&ne.current.resetPreview(),a({}),l({}),B({}),y(void 0),t.location.pathname!==me&&t.push(me)})({setValues:ve,setTouched:he,setErrors:Oe})},a("COMMON.BUTTON.NEW")),i.a.createElement(r.g,{type:"button",color:"warning",size:"sm",rounded:!0,onClick:S},a("COMMON.BUTTON.BACK"))))))))))})}}]);